import{j as e,R as U,a as k}from"./index-JBMyroTg.js";import{r}from"./vendor-C8lAA81b.js";import{u as P}from"./useEmployees-D0hjL4_K.js";import{I as D,_ as H,h as c,T as A,y as N,C as x,z as O,d as V,B as _,l as W,c as v,e as G,f as R,E as T,G as F,H as o,m as J,J as K,s as z}from"./antd-7IfSoTVm.js";import{R as q}from"./FileImageOutlined-Bi8tJCRf.js";var Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"},X=function(l,n){return r.createElement(D,H({},l,{ref:n,icon:Q}))},Y=r.forwardRef(X);const{Title:Z,Text:d}=A,ae=()=>{var I;const g="http://localhost:8000",{employees:l}=P(),[n,y]=r.useState(""),[s,L]=r.useState(null),[p,j]=r.useState(null),[B,m]=r.useState(!1),[h,f]=r.useState(!1),[C,b]=r.useState(!1),$=r.useMemo(()=>n.length<2?[]:l.filter(t=>t.employee_id.includes(n)||t.employee_old_id&&t.employee_old_id.includes(n)||t.employee_name.toLowerCase().includes(n.toLowerCase())).slice(0,10).map(t=>({value:t.employee_id,label:e.jsxs(c,{justify:"space-between",children:[e.jsxs("span",{children:[t.employee_id," - ",e.jsx("b",{children:t.employee_name})]}),e.jsx(d,{type:"secondary",style:{fontSize:12},children:t.employee_department})]})})),[n,l]),w=t=>{const i=t.trim().toUpperCase();if(!i)return;m(!0),f(!1),j(null);const a=l.find(M=>M.employee_id===i);L(a);const S=`${g}/images/${i}.png`,u=new window.Image;u.src=S,u.onload=()=>{j(S),m(!1)},u.onerror=()=>{f(!0),m(!1)}},E=async()=>{if(!(!p||h)){b(!0);try{const t=await k.get(`/api/download/${(s==null?void 0:s.employee_id)||n}`,{responseType:"blob"}),i=new Blob([t.data],{type:"image/png"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=`${(s==null?void 0:s.employee_id)||n}.png`,a.click(),z.success(`Đã tải xuống: ${a.download}`)}catch{z.error("Lỗi tải ảnh từ Server.")}finally{b(!1)}}};return e.jsxs("div",{style:{maxWidth:900,margin:"0 auto",padding:"20px 10px"},children:[e.jsxs(c,{vertical:!0,align:"center",style:{marginBottom:40},children:[e.jsx(N,{count:e.jsx(Y,{style:{color:"#1890ff",fontSize:20}}),children:e.jsx(Z,{level:2,style:{margin:0},children:"Employee Directory"})}),e.jsx(d,{type:"secondary",children:"Tra cứu hồ sơ ảnh và thông tin nhân sự"})]}),e.jsx(x,{variant:"borderless",style:{marginBottom:24,boxShadow:"0 8px 24px rgba(0,0,0,0.05)",borderRadius:16},children:e.jsx(O,{popupMatchSelectWidth:!0,style:{width:"100%"},options:$,onSelect:t=>{y(t),w(t)},onSearch:y,children:e.jsx(V.Search,{placeholder:"Nhập ID, Tên hoặc Mã thẻ cũ...",enterButton:e.jsx(_,{type:"primary",icon:e.jsx(W,{}),children:"Tra cứu"}),size:"large",onSearch:w})})}),B?e.jsxs(c,{vertical:!0,align:"center",justify:"center",style:{padding:100},children:[e.jsx(v,{size:"large"}),e.jsx(d,{type:"secondary",style:{marginTop:16},children:"Đang truy xuất dữ liệu..."})]}):p||h?e.jsxs(G,{gutter:[24,24],children:[e.jsx(R,{xs:24,md:10,children:e.jsx(x,{variant:"borderless",style:{textAlign:"center",borderRadius:16,overflow:"hidden",background:"#fafafa"},children:h?e.jsx(T,{description:"Không có ảnh chân dung"}):e.jsx(F,{src:p,style:{borderRadius:8,width:"100%",maxWidth:280,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},placeholder:e.jsx(v,{})})})}),e.jsx(R,{xs:24,md:14,children:e.jsxs(x,{title:e.jsxs(c,{gap:8,align:"center",children:[e.jsx(U,{})," Hồ sơ chi tiết"]}),variant:"borderless",style:{borderRadius:16,boxShadow:"0 8px 24px rgba(0,0,0,0.05)"},children:[s?e.jsxs(o,{column:1,bordered:!0,size:"small",children:[e.jsx(o.Item,{label:"Họ tên",children:e.jsx(d,{strong:!0,children:s.employee_name})}),e.jsx(o.Item,{label:"Mã NV",children:s.employee_id}),e.jsx(o.Item,{label:"Mã thẻ cũ",children:s.employee_old_id||"-"}),e.jsx(o.Item,{label:"Bộ phận",children:s.employee_department}),e.jsx(o.Item,{label:"Trạng thái",children:e.jsx(J,{color:s.employee_status==="Active"?"green":"red",children:(I=s.employee_status)==null?void 0:I.toUpperCase()})})]}):e.jsx(T,{description:"Thông tin nhân sự không có sẵn"}),e.jsx(_,{type:"primary",icon:e.jsx(K,{}),block:!0,size:"large",onClick:E,disabled:h,loading:C,style:{marginTop:24,height:45,borderRadius:8},children:"Tải ảnh PNG gốc"})]})})]}):e.jsxs(c,{vertical:!0,align:"center",style:{marginTop:80,color:"#d9d9d9"},children:[e.jsx(q,{style:{fontSize:80,marginBottom:20}}),e.jsx(d,{type:"secondary",children:"Nhập thông tin nhân viên để bắt đầu"})]})]})};export{ae as default};
