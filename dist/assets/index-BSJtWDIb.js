import{j as e,c as j,R as le}from"./index-JBMyroTg.js";import{r as c,e as de,g as ce}from"./vendor-C8lAA81b.js";import{I as N,_ as W,h as b,T as S,S as pe,B as x,i as me,j as y,k as he,d as ge,l as xe,m as f,n as M,o as ue,b as I,p as L,q as ye,E as fe,r as be,t as H}from"./antd-7IfSoTVm.js";import{u as je}from"./useEmployees-D0hjL4_K.js";import{l as F}from"./index-CZ9vExK5.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M874 120H622c-3.3 0-6 2.7-6 6v56c0 3.3 2.7 6 6 6h160.4L583.1 387.3c-50-38.5-111-59.3-175.1-59.3-76.9 0-149.3 30-203.6 84.4S120 539.1 120 616s30 149.3 84.4 203.6C258.7 874 331.1 904 408 904s149.3-30 203.6-84.4C666 765.3 696 692.9 696 616c0-64.1-20.8-124.9-59.2-174.9L836 241.9V402c0 3.3 2.7 6 6 6h56c3.3 0 6-2.7 6-6V150c0-16.5-13.5-30-30-30zM408 828c-116.9 0-212-95.1-212-212s95.1-212 212-212 212 95.1 212 212-95.1 212-212 212z"}}]},name:"man",theme:"outlined"},we=function(s,i){return c.createElement(N,W({},s,{ref:i,icon:ve}))},Se=c.forwardRef(we),_e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M712.8 548.8c53.6-53.6 83.2-125 83.2-200.8 0-75.9-29.5-147.2-83.2-200.8C659.2 93.6 587.8 64 512 64s-147.2 29.5-200.8 83.2C257.6 200.9 228 272.1 228 348c0 63.8 20.9 124.4 59.4 173.9 7.3 9.4 15.2 18.3 23.7 26.9 8.5 8.5 17.5 16.4 26.8 23.7 39.6 30.8 86.3 50.4 136.1 57V736H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h114v140c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V812h114c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H550V629.5c61.5-8.2 118.2-36.1 162.8-80.7zM512 556c-55.6 0-107.7-21.6-147.1-60.9C325.6 455.8 304 403.6 304 348s21.6-107.7 60.9-147.1C404.2 161.5 456.4 140 512 140s107.7 21.6 147.1 60.9C698.4 240.2 720 292.4 720 348s-21.6 107.7-60.9 147.1C619.7 534.4 567.6 556 512 556z"}}]},name:"woman",theme:"outlined"},Re=function(s,i){return c.createElement(N,W({},s,{ref:i,icon:_e}))},Ce=c.forwardRef(Re),V={exports:{}};(function(n,s){(function(i,l){n.exports=l()})(de,function(){return function(i,l,a){l.prototype.isBetween=function(t,r,o,g){var d=a(t),p=a(r),h=(g=g||"()")[0]==="(",u=g[1]===")";return(h?this.isAfter(d,o):!this.isBefore(d,o))&&(u?this.isBefore(p,o):!this.isAfter(p,o))||(h?this.isBefore(d,o):!this.isAfter(d,o))&&(u?this.isAfter(p,o):!this.isBefore(p,o))}}})})(V);var Ie=V.exports;const ke=ce(Ie),{Title:Te,Text:De}=S,{RangePicker:Ae}=he,ze=({viewStatus:n,setViewStatus:s,searchText:i,setSearchText:l,onRefresh:a,loading:t,canCRUD:r,dateRange:o,setDateRange:g,selectedCount:d=0,onBulkPrint:p})=>e.jsxs(b,{vertical:!0,gap:"middle",style:{marginBottom:20,background:"#fff",padding:"20px",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[e.jsxs(b,{justify:"space-between",align:"center",wrap:"wrap",gap:"middle",children:[e.jsxs(b,{vertical:!0,gap:0,children:[e.jsx(Te,{level:4,style:{margin:0},children:n==="Active"?"Active Employees":n==="All"?"All Employees":"Resigned Employees"}),e.jsx(De,{type:"secondary",children:"Data source: HR System (Live)"})]}),e.jsxs(pe,{wrap:!0,children:[d>0&&e.jsxs(x,{type:"primary",danger:!0,icon:e.jsx(j,{}),onClick:p,style:{boxShadow:"0 2px 4px rgba(255, 77, 79, 0.3)"},children:["Print ",d," Selected"]}),e.jsx(x,{icon:e.jsx(me,{}),onClick:a,loading:t,children:"Refresh"}),e.jsxs(y.Group,{value:n,onChange:h=>s(h.target.value),buttonStyle:"solid",children:[e.jsx(y.Button,{value:"Active",children:"Active"}),e.jsx(y.Button,{value:"Resign",children:"Resigned"}),e.jsx(y.Button,{value:"All",children:"All"})]}),e.jsx(x,{type:"primary",icon:e.jsx(le,{}),disabled:!r,children:"Add Employee"})]})]}),e.jsxs(b,{gap:"middle",wrap:"wrap",children:[e.jsx(Ae,{placeholder:["Join Date From","To Date"],format:"DD/MM/YYYY",value:o,onChange:h=>g(h),style:{minWidth:250},size:"large"}),e.jsx(ge,{placeholder:"Search by Name, ID or Department...",prefix:e.jsx(xe,{style:{color:"#bfbfbf"}}),size:"large",allowClear:!0,value:i,onChange:h=>l(h.target.value),style:{borderRadius:"8px",flex:1,minWidth:300}})]})]}),{Text:w}=S,Pe=({dataSource:n,loading:s,onPrint:i,rowSelection:l})=>{const a=[{title:"Identity",width:140,fixed:"left",render:(t,r)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx(w,{strong:!0,copyable:{text:r.employee_id},children:r.employee_id}),r.employee_old_id&&e.jsxs(w,{type:"secondary",style:{fontSize:12},children:["Old: ",r.employee_old_id]})]}),sorter:(t,r)=>t.employee_id.localeCompare(r.employee_id)},{title:"Full Name",dataIndex:"employee_name",width:180,fixed:"left",render:t=>e.jsx(w,{strong:!0,style:{color:"#262626"},children:t}),sorter:(t,r)=>t.employee_name.localeCompare(r.employee_name)},{title:"Department",dataIndex:"employee_department",width:150,render:t=>e.jsx(f,{color:"geekblue",style:{marginRight:0},children:t}),filters:[...new Set(n.map(t=>t.employee_department).filter(Boolean))].map(t=>({text:t,value:t})),onFilter:(t,r)=>r.employee_department.includes(t)},{title:"Position",dataIndex:"employee_position",width:180,ellipsis:!0},{title:"Status",dataIndex:"employee_status",width:100,align:"center",render:t=>e.jsx(f,{color:t==="Active"?"success":"error",children:t?t.toUpperCase():"UNKNOWN"})},{title:"Gender",dataIndex:"employee_gender",width:80,align:"center",render:t=>t==="Nam"?e.jsx(f,{icon:e.jsx(Se,{}),color:"blue",children:"Nam"}):e.jsx(f,{icon:e.jsx(Ce,{}),color:"magenta",children:"Ná»¯"})},{title:"DOB",dataIndex:"employee_birth_date",width:110,align:"center"},{title:"Join Date",dataIndex:"employee_join_date",width:110,align:"center"},{title:"Left Date",dataIndex:"employee_left_date",width:110,align:"center",render:t=>t?e.jsx(w,{type:"danger",children:t}):"-"},{title:"Contract Info",children:[{title:"Type",dataIndex:"contract_type",width:130,ellipsis:!0,render:t=>t?e.jsx(M,{title:t,children:t}):"-"},{title:"Contract No",dataIndex:"contract_id",width:130,ellipsis:!0},{title:"Duration",width:180,render:(t,r)=>r.contract_begin?e.jsxs("span",{style:{fontSize:12},children:[r.contract_begin," - ",r.contract_end||"..."]}):"-"}]},{title:"Maternity",children:[{title:"Type",dataIndex:"maternity_type",width:120,ellipsis:!0},{title:"Dates",width:180,render:(t,r)=>r.maternity_begin?e.jsxs(f,{color:"purple",style:{fontSize:11},children:[r.maternity_begin," to ",r.maternity_end]}):"-"}]},{title:"Action",key:"action",fixed:"right",width:90,align:"center",render:(t,r)=>e.jsx(M,{title:r.employee_status==="Active"?"Print ID Card":"Cannot print for resigned staff",children:e.jsx(x,{type:"primary",icon:e.jsx(j,{}),size:"small",disabled:r.employee_status!=="Active",onClick:o=>{o.stopPropagation(),i(r)}})})}];return e.jsx(ue,{rowSelection:l,columns:a,dataSource:n,loading:s,rowKey:"employee_id",pagination:{pageSize:25,showSizeChanger:!0,showTotal:(t,r)=>`${r[0]}-${r[1]} of ${t} employees`,placement:["bottomRight"]},bordered:!0,size:"small",scroll:{x:2200,y:"calc(100vh - 450px)"},style:{background:"#fff",borderRadius:"12px",overflow:"hidden"}})},K=({isDarkBg:n})=>e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:n?"rgba(255,255,255,0.15)":"#f5f5f5",color:n?"rgba(255,255,255,0.7)":"#bbb",fontWeight:"600",fontSize:"10px",fontFamily:'"Roboto", sans-serif',border:n?"1px dashed rgba(255,255,255,0.3)":"1px dashed #ddd",flexDirection:"column",letterSpacing:"0.5px"},children:e.jsx("span",{children:"NO PHOTO"})}),U=()=>e.jsx("img",{src:"/assets/stamp.png",alt:"Stamp",style:{position:"absolute",right:"1mm",bottom:"1mm",width:"12mm",opacity:.8,transform:"rotate(-15deg)",pointerEvents:"none",zIndex:20}}),Be=({data:n,employeeImg:s,bgImage:i,imageError:l,setImageError:a,showStamp:t})=>e.jsxs("div",{style:{width:"54mm",height:"85.6mm",backgroundImage:i,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative",display:"flex",flexDirection:"column",alignItems:"center",fontFamily:"Arial, Helvetica, sans-serif",color:"#000",boxSizing:"border-box"},children:[e.jsxs("div",{style:{marginTop:"14mm",width:"32mm",height:"40mm",position:"relative",borderRadius:"4px",border:"1px solid rgba(0,0,0,0.35)",background:"#fff"},children:[l?e.jsx(K,{isDarkBg:!1}):e.jsx("img",{src:s,alt:"Avatar",onError:()=>a(!0),style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",display:"block"}}),t&&e.jsx("div",{style:{position:"absolute",bottom:"-2mm",right:"-4mm",zIndex:10},children:e.jsx(U,{})})]}),e.jsxs("div",{style:{flex:1,width:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",padding:"3mm 3mm 5mm"},children:[e.jsx("div",{style:{marginTop:"0mm",fontSize:"10px",fontWeight:400,lineHeight:"1.3",textTransform:"uppercase",letterSpacing:"0.5px",whiteSpace:"normal"},children:n.employee_position}),e.jsx("div",{style:{marginTop:"1mm",fontSize:"13px",fontWeight:700,whiteSpace:"nowrap"},children:n.employee_name}),e.jsx("div",{style:{marginTop:"0mm",fontSize:"11px",fontWeight:500,letterSpacing:"1px",whiteSpace:"nowrap"},children:n.employee_id}),e.jsx("div",{style:{marginTop:"1mm",fontSize:"10px",fontWeight:600,letterSpacing:"0.8px",textTransform:"uppercase",whiteSpace:"nowrap"},children:n.employee_department})]})]}),Oe=({data:n,employeeImg:s,bgImage:i,imageError:l,setImageError:a,showStamp:t})=>e.jsxs("div",{style:{width:"85.6mm",height:"54mm",backgroundImage:i,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative",display:"flex",fontFamily:"Arial, Helvetica, sans-serif",color:"#ffffff",boxSizing:"border-box"},children:[e.jsx("div",{style:{width:"30mm",display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:"4mm"},children:e.jsxs("div",{style:{width:"23mm",height:"30mm",position:"relative",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.6)",background:"rgba(255,255,255,0.1)"},children:[l?e.jsx(K,{isDarkBg:!0}):e.jsx("img",{src:s,alt:"Avatar",onError:()=>a(!0),style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",display:"block"}}),t&&e.jsx("div",{style:{position:"absolute",bottom:"-3mm",right:"-3mm",zIndex:999},children:e.jsx(U,{})})]})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",paddingRight:"4mm"},children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:650,letterSpacing:"1px",textTransform:"uppercase",whiteSpace:"nowrap"},children:n.employee_position}),e.jsx("div",{style:{fontSize:"14px",fontWeight:750,marginTop:"2mm",marginBottom:"2mm",whiteSpace:"nowrap"},children:n.employee_name}),e.jsx("div",{style:{fontSize:"12px",fontWeight:520,letterSpacing:"1px",whiteSpace:"nowrap"},children:n.employee_id}),e.jsx("div",{style:{marginTop:"2mm",fontSize:"10px",fontWeight:600,letterSpacing:"0.8px",textTransform:"uppercase",whiteSpace:"nowrap"},children:n.employee_department})]})]}),k=({data:n,bgOption:s=1,showStamp:i=!1})=>{const[l,a]=c.useState(!1);if(!n)return null;const r=`http://localhost:8000/images/${n.employee_id}.png`,o=n.employee_type==="Worker",g=n.maternity_type||"";let d="";g==="Pregnancy Register"?d=o?"/assets/bau-doc.png":"/assets/bau-ngang.png":g==="Has Baby"?d=o?"/assets/baby-doc.png":"/assets/baby-ngang.png":d=o?"/assets/card-bg-vertical.png":s===1?"/assets/card-bg-horizontal.png":"/assets/card-bg-horizontal-2.png";const p=`url("${d}")`,h=o?"54mm":"85.6mm",u=o?"85.6mm":"54mm";return e.jsxs("div",{className:"print-container",children:[o?e.jsx(Be,{data:n,employeeImg:r,bgImage:p,imageError:l,setImageError:a,showStamp:i}):e.jsx(Oe,{data:n,employeeImg:r,bgImage:p,imageError:l,setImageError:a,showStamp:i}),e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Roboto:wght@400;500;700&display=swap');
        @media print {
          @page { size: ${h} ${u}; margin: 0 !important; }
          body { margin: 0 !important; padding: 0 !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
          body * { visibility: hidden; }
          .print-container, .print-container * { visibility: visible !important; }
          .print-container { position: absolute !important; top: 0 !important; left: 0 !important; width: ${h} !important; height: ${u} !important; }
        }
      `})]})},$e="http://localhost:8000",G=async n=>{if(!n||n.length===0)return;const s=n.map(i=>({employee_id:i.employee_id,employee_name:i.employee_name,employee_type:i.employee_type||"Staff",maternity_type:i.maternity_type||"",printed_at:new Date().toISOString()}));try{if(!(await fetch(`${$e}/api/log-print`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Server returned error");console.log(`[System] Logged ${s.length} print records.`)}catch(i){console.error("Failed to log print history:",i),I.warning({message:"Cáº£nh bÃ¡o há»‡ thá»‘ng",description:"KhÃ´ng thá»ƒ lÆ°u lá»‹ch sá»­ in. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i Server.",placement:"bottomRight"})}},{Text:C}=S,Ee=({open:n,onClose:s,employee:i})=>{const[l,a]=c.useState(1),[t,r]=c.useState(!1),o=c.useRef(null),g=F.useReactToPrint({contentRef:o,documentTitle:i?`IDCard_${i.employee_id}`:"IDCard"}),d=()=>{i&&(setTimeout(()=>g(),100),G([i]))};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:e.jsxs(C,{strong:!0,children:[e.jsx(j,{})," Print ID Card"]}),open:n,onCancel:s,destroyOnHidden:!0,footer:[e.jsx(x,{onClick:s,children:"Cancel"},"back"),e.jsx(x,{type:"primary",icon:e.jsx(j,{}),onClick:d,children:"Print Now"},"submit")],width:500,centered:!0,children:e.jsxs("div",{style:{padding:"20px",background:"#f0f2f5",display:"flex",flexDirection:"column",alignItems:"center",borderRadius:"8px"},children:[e.jsxs(b,{gap:"small",vertical:!0,style:{width:"100%",alignItems:"center",marginBottom:15},children:[i&&i.employee_type!=="Worker"&&e.jsxs("div",{style:{background:"#fff",padding:"8px 20px",borderRadius:"20px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(C,{strong:!0,style:{marginRight:12},children:"Design:"}),e.jsxs(y.Group,{onChange:p=>a(p.target.value),value:l,children:[e.jsx(y,{value:1,children:"Standard"}),e.jsx(y,{value:2,children:"Modern"})]})]}),e.jsx("div",{style:{background:"#fff",padding:"8px 20px",borderRadius:"20px",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:e.jsx(ye,{checked:t,onChange:p=>r(p.target.checked),children:e.jsx(C,{strong:!0,style:{color:"#1890ff"},children:'Add "Access Granted" Stamp'})})})]}),e.jsx(k,{data:i,bgOption:l,showStamp:t})]})}),e.jsx("div",{style:{display:"none"},children:e.jsx("div",{ref:o,children:i&&e.jsx("div",{className:"print-only",children:e.jsx(k,{data:i,bgOption:l,showStamp:t})})})})]})},Me=({open:n,onClose:s,selectedEmployees:i=[]})=>{const l=c.useRef(),a=F.useReactToPrint({contentRef:l,documentTitle:"Danh_sach_the_nhan_vien",pageStyle:`
      @page { margin: 0; }
      body { margin: 0; }
    `}),t=()=>{a&&a(),G(i)};return e.jsxs(L,{title:e.jsxs(S.Title,{level:4,style:{margin:0},children:["ðŸ–¨ï¸ Xem trÆ°á»›c báº£n in (",i.length," tháº»)"]}),open:n,onCancel:s,width:1e3,centered:!0,footer:null,styles:{body:{padding:0}},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"70vh"},children:[e.jsx("div",{style:{flex:1,overflowY:"auto",background:"#525659",padding:"40px"},children:i.length===0?e.jsx("div",{style:{background:"#fff",padding:40,borderRadius:8},children:e.jsx(fe,{description:"ChÆ°a chá»n nhÃ¢n viÃªn nÃ o Ä‘á»ƒ in"})}):e.jsx("div",{ref:l,className:"print-container-wrapper",children:e.jsx("div",{className:"print-grid",children:i.map((r,o)=>e.jsx("div",{className:"print-item",children:e.jsx(k,{data:r,bgOption:1,showStamp:!0})},r.employee_id||o))})})}),e.jsxs("div",{style:{padding:"16px 24px",background:"#fff",borderTop:"1px solid #e8e8e8",display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx(x,{onClick:s,icon:e.jsx(be,{}),children:"Há»§y bá»"}),e.jsx(x,{type:"primary",icon:e.jsx(j,{}),size:"large",disabled:i.length===0,onClick:t,children:"Tiáº¿n hÃ nh In"})]})]}),e.jsx("style",{children:`
        .print-grid {
          display: flex;
          flex-wrap: wrap;
          gap: 20px;
          justify-content: center;
        }

        @media print {
          .print-container-wrapper { background: none !important; }
          .print-grid { display: block !important; gap: 0; }
          .print-item {
            page-break-after: always;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
          }
          body * { visibility: hidden; }
          .print-container-wrapper, .print-container-wrapper * { visibility: visible; }
        }
      `})]})};H.extend(ke);const Ve=()=>{const{employees:n,loading:s,fetchEmployees:i,isLoaded:l}=je(),a=c.useRef(!1),[t,r]=c.useState(""),[o,g]=c.useState("Active"),[d,p]=c.useState([null,null]),[h,u]=c.useState([]),[T,Y]=c.useState([]),[J,D]=c.useState(!1),[q,A]=c.useState(!1),[Q,X]=c.useState(null),z=c.useMemo(()=>JSON.parse(localStorage.getItem("user")||"{}"),[]),Z=z.role?z.role.toLowerCase():"",ee=["admin","it","hr"].includes(Z),P=async(m=!1)=>{if(m&&(a.current=!1),!(l&&!m))try{await i(m),!a.current&&m&&(I.success({message:"LÃ m má»›i dá»¯ liá»‡u thÃ nh cÃ´ng"}),a.current=!0)}catch{a.current||(I.error({message:"KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u"}),a.current=!0)}};c.useEffect(()=>{P()},[]);const te=c.useMemo(()=>n.filter(m=>{var B,O,$;const v=m.employee_status||"",re=o==="All"?!0:o==="Active"?v==="Active":v!=="Active",_=t.toLowerCase(),oe=(B=m.employee_name)==null?void 0:B.toLowerCase().includes(_),se=(O=m.employee_id)==null?void 0:O.toLowerCase().includes(_),ae=($=m.employee_department)==null?void 0:$.toLowerCase().includes(_);let R=!0;if(d&&d[0]&&d[1]&&m.employee_join_date){const E=H(m.employee_join_date);E.isValid()?R=E.isBetween(d[0],d[1],"day","[]"):R=!1}return re&&(oe||se||ae)&&R}),[n,t,o,d]),ne={selectedRowKeys:h,onChange:(m,v)=>{u(m),Y(v)},preserveSelectedRowKeys:!0},ie=m=>{X(m),A(!0)};return e.jsxs("div",{style:{padding:"0 4px"},children:[e.jsx("h2",{style:{marginBottom:20,color:"#001529"},children:"Quáº£n lÃ½ Danh sÃ¡ch NhÃ¢n viÃªn"}),e.jsx(ze,{viewStatus:o,setViewStatus:g,searchText:t,setSearchText:r,dateRange:d,setDateRange:p,selectedCount:T.length,onBulkPrint:()=>D(!0),onRefresh:()=>P(!0),loading:s,canCRUD:ee}),e.jsx(Pe,{dataSource:te,loading:s,onPrint:ie,rowSelection:ne}),e.jsx(Ee,{open:q,onClose:()=>A(!1),employee:Q}),e.jsx(Me,{open:J,onClose:()=>D(!1),selectedEmployees:T})]})};export{Ve as default};
